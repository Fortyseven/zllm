var ve=Object.defineProperty;var Se=(e,t,i)=>t in e?ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Q=(e,t,i)=>(Se(e,typeof t!="symbol"?t+"":t,i),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();function w(){}function be(e){return e()}function he(){return Object.create(null)}function L(e){e.forEach(be)}function ae(e){return typeof e=="function"}function K(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Te(e){return Object.keys(e).length===0}function Ee(e,...t){if(e==null){for(const r of t)r(void 0);return w}const i=e.subscribe(...t);return i.unsubscribe?()=>i.unsubscribe():i}function de(e,t,i){e.$$.on_destroy.push(Ee(t,i))}function X(e,t,i){return e.set(i),t}function Ie(e){return e&&ae(e.destroy)?e.destroy:w}function ze(e,t){e.appendChild(t)}function B(e,t,i){e.insertBefore(t,i||null)}function C(e){e.parentNode&&e.parentNode.removeChild(e)}function ue(e){return document.createElement(e)}function oe(e){return document.createTextNode(e)}function Ue(){return oe(" ")}function Ae(){return oe("")}function Y(e,t,i,r){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i,r)}function ye(e,t,i){i==null?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function Ce(e){return Array.from(e.childNodes)}function xe(e,t){t=""+t,e.data!==t&&(e.data=t)}function pe(e,t){e.value=t??""}function Le(e,t,{bubbles:i=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:i,cancelable:r})}function ge(e,t){return new e(t)}let N;function F(e){N=e}function _e(){if(!N)throw new Error("Function called outside component initialization");return N}function Pe(e){_e().$$.on_mount.push(e)}function je(){const e=_e();return(t,i,{cancelable:r=!1}={})=>{const n=e.$$.callbacks[t];if(n){const s=Le(t,i,{cancelable:r});return n.slice().forEach(o=>{o.call(e,s)}),!s.defaultPrevented}return!0}}const A=[],D=[];let x=[];const me=[],Me=Promise.resolve();let te=!1;function Oe(){te||(te=!0,Me.then(we))}function ne(e){x.push(e)}const ee=new Set;let z=0;function we(){if(z!==0)return;const e=N;do{try{for(;z<A.length;){const t=A[z];z++,F(t),Be(t.$$)}}catch(t){throw A.length=0,z=0,t}for(F(null),A.length=0,z=0;D.length;)D.pop()();for(let t=0;t<x.length;t+=1){const i=x[t];ee.has(i)||(ee.add(i),i())}x.length=0}while(A.length);for(;me.length;)me.pop()();te=!1,ee.clear(),F(e)}function Be(e){if(e.fragment!==null){e.update(),L(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ne)}}function Fe(e){const t=[],i=[];x.forEach(r=>e.indexOf(r)===-1?t.push(r):i.push(r)),i.forEach(r=>r()),x=t}const V=new Set;let I;function Ne(){I={r:0,c:[],p:I}}function Ze(){I.r||L(I.c),I=I.p}function J(e,t){e&&e.i&&(V.delete(e),e.i(t))}function ie(e,t,i,r){if(e&&e.o){if(V.has(e))return;V.add(e),I.c.push(()=>{V.delete(e),r&&(i&&e.d(1),r())}),e.o(t)}else r&&r()}function re(e){e&&e.c()}function R(e,t,i){const{fragment:r,after_update:n}=e.$$;r&&r.m(t,i),ne(()=>{const s=e.$$.on_mount.map(be).filter(ae);e.$$.on_destroy?e.$$.on_destroy.push(...s):L(s),e.$$.on_mount=[]}),n.forEach(ne)}function q(e,t){const i=e.$$;i.fragment!==null&&(Fe(i.after_update),L(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}function Ve(e,t){e.$$.dirty[0]===-1&&(A.push(e),Oe(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function le(e,t,i,r,n,s,o=null,a=[-1]){const h=N;F(e);const u=e.$$={fragment:null,ctx:[],props:s,update:w,not_equal:n,bound:he(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(h?h.$$.context:[])),callbacks:he(),dirty:a,skip_bound:!1,root:t.target||h.$$.root};o&&o(u.root);let l=!1;if(u.ctx=i?i(e,t.props||{},(f,y,...d)=>{const $=d.length?d[0]:y;return u.ctx&&n(u.ctx[f],u.ctx[f]=$)&&(!u.skip_bound&&u.bound[f]&&u.bound[f]($),l&&Ve(e,f)),y}):[],u.update(),l=!0,L(u.before_update),u.fragment=r?r(u.ctx):!1,t.target){if(t.hydrate){const f=Ce(t.target);u.fragment&&u.fragment.l(f),f.forEach(C)}else u.fragment&&u.fragment.c();t.intro&&J(e.$$.fragment),R(e,t.target,t.anchor),we()}F(h)}class ce{constructor(){Q(this,"$$");Q(this,"$$set")}$destroy(){q(this,1),this.$destroy=w}$on(t,i){if(!ae(i))return w;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(i),()=>{const n=r.indexOf(i);n!==-1&&r.splice(n,1)}}$set(t){this.$$set&&!Te(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const De="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(De);const U=[];function ke(e,t=w){let i;const r=new Set;function n(a){if(K(e,a)&&(e=a,i)){const h=!U.length;for(const u of r)u[1](),U.push(u,e);if(h){for(let u=0;u<U.length;u+=2)U[u][0](U[u+1]);U.length=0}}}function s(a){n(a(e))}function o(a,h=w){const u=[a,h];return r.add(u),r.size===1&&(i=t(n,s)||w),a(e),()=>{r.delete(u),r.size===0&&i&&(i(),i=null)}}return{set:n,update:s,subscribe:o}}let se=ke("");function Je(e){let t,i,r;return{c(){t=ue("input"),ye(t,"class","svelte-11vndvz")},m(n,s){B(n,t,s),e[5](t),pe(t,e[0]),i||(r=[Ie(Re.call(null,t)),Y(t,"input",e[6]),Y(t,"submit",e[3]),Y(t,"keydown",e[7])],i=!0)},p(n,[s]){s&1&&t.value!==n[0]&&pe(t,n[0])},i:w,o:w,d(n){n&&C(t),e[5](null),i=!1,L(r)}}}function Re(e){e.focus()}function $e(e){console.log(">>",e)}function qe(e,t,i){let r="",n="",s;const o=je();se.subscribe(f=>{console.log("output:",f)});function a(f){f.preventDefault(),o("zinput",r),i(0,r="")}function h(f){D[f?"unshift":"push"](()=>{s=f,i(2,s)})}function u(){r=this.value,i(0,r)}return[r,n,s,a,$e,h,u,f=>{f.key==="Enter"&&(i(1,n=r),a(f)),f.key==="ArrowUp"&&(console.log("ArrowUp"),i(0,r=n),setTimeout(()=>{i(2,s.selectionStart=i(2,s.selectionEnd=r.length,s),s)},50))}]}class He extends ce{constructor(t){super(),le(this,t,qe,Je,K,{receiveTextResponse:4})}get receiveTextResponse(){return $e}}const Ke="/assets/zork-CC8eWaLu.z3",We={major:2,minor:0,subminor:3,timestamp:1518834833649};function H(e){let t;if(t=this.memInit=new Uint8Array(e),t[0]!=3)throw new Error("Unsupported Z-code version.");this.byteSwapped=!!(t[1]&1),this.statusType=!!(t[1]&2),this.serial=String.fromCharCode(...t.slice(18,24)),this.zorkid=t[2]<<(this.byteSwapped?0:8)|t[3]<<(this.byteSwapped?8:0)}H.prototype={byteSwapped:!1,constructor:H,deserialize:function(e){let t,i,r,n,s,o,a,h,u,l,f,y,d;u=()=>e[t++],l=()=>(t+=2,a.getInt16(t-2)),f=()=>(t+=2,a.getUint16(t-2)),y=()=>(t+=3,a.getUint32(t-4)&16777215),d=()=>(t+=4,a.getUint32(t-4));try{if(t=h=this.getu(14),a=new DataView(e.buffer),e[2]!=this.mem[2]||e[3]!=this.mem[3])return null;for(o=d(),s=new Array(f()),n=Array.from({length:f()},l),i=0;i<s.length;i++)for(s[i]={},s[i].local=new Int16Array(u()),s[i].pc=y(),s[i].ds=Array.from({length:f()},l),r=0;r<s[i].local.length;r++)s[i].local[r]=l();return this.mem.set(new Uint8Array(e.buffer,0,h)),[n,s,o]}catch{return null}},endText:0,fwords:null,genPrint:function*(e){var t=this.get(16);t!=this.savedFlags&&(this.savedFlags=t,yield*this.highlight(!!(t&2))),yield*this.print(e,!!(t&1))},get:function(e){return this.view.getInt16(e,this.byteSwapped)},getText:function(e){let t,i="",r=0,n=0,s,o;for(t=a=>{n==3?(o=a<<5,n=4):n==4?(o+=a,o==13?i+=`
`:o&&(i+=String.fromCharCode(o)),n=r):n==5?(i+=this.getText(this.getu(this.fwords+(o+a)*2)*2),n=r):a==0?i+=" ":a<4?(n=5,o=(a-1)*32):a<6?n?n==a-3?r=n:r=n=0:n=a-3:a==6&&n==2?n=3:(i+=`abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ*
0123456789.,!?_#'"/\\-:()`[n*26+a-6],n=r)};s=this.getu(e),e+=2,t(s>>10&31),t(s>>5&31),t(s&31),!(s&32768););return this.endText=e,i},getu:function(e){return this.view.getUint16(e,this.byteSwapped)},handleInput:function(e,t,i){let r,n,s;for(e=e.toLowerCase().slice(0,this.mem[t]-1),r=0;r<e.length;r++)this.mem[t+r+1]=e.charCodeAt(r);for(this.mem[t+e.length+1]=0,s=o=>(r=0,o.split("").filter(a=>(r+=/[a-z]/.test(a)?1:/[0-9.,!?_#'"\/\\:\-()]/.test(a)?2:4)<7).join("")),n=JSON.parse("["+e.replace(this.regBreak,(o,a)=>",["+o.length+","+(this.vocabulary.get(s(o))||0)+","+(a+1)+"]").slice(1)+"]"),r=this.mem[i+1]=n.length;r--;)this.putu(i+r*4+2,n[r][1]),this.mem[i+r*4+4]=n[r][0],this.mem[i+r*4+5]=n[r][2]},highlight:()=>[],isTandy:!1,mem:null,memInit:null,parseVocab:function(e){let t,i;if(this.vocabulary=new Map,!e)return this.selfInsertingBreaks="",this.regBreak=/[^ \n\t]+/g,e;for(i=this.mem[e++],t=this.selfInsertingBreaks=String.fromCharCode(...this.mem.slice(e,e+i)),t=t.split("").map(r=>(r.toUpperCase()==r.toLowerCase()?"":"\\")+r).join("")+"]",this.regBreak=new RegExp("["+t+"|[^ \\n\\t"+t+"+","g"),e+=i,t=this.mem[e++],i=this.get(e),e+=2;i--;)this.vocabulary.set(this.getText(e),e),e+=t;return e},print:()=>[],put:function(e,t){return this.view.setInt16(e,t,this.byteSwapped)},putu:function(e,t){return this.view.setUint16(e,t&65535,this.byteSwapped)},read:()=>[],regBreak:null,restarted:()=>[],restore:()=>[],run:function*(){let e,t,i,r,n,s,o,a,h,u,l,f,y,d,$,P,m,S,W,G,j,M,Z,k,b,O,T,g,_,E;for(P=c=>(c&65535)<<1,m=c=>c==0?r.pop():c<16?i[0].local[c-1]:this.get(y+2*c),S=()=>{a=1<<(15&~s),o=d+n*9+(s&16?2:0),h=this.get(o)},W=()=>{e=this.mem=new Uint8Array(this.memInit),this.view=new DataView(e.buffer),e[1]&=3,this.isTandy&&(e[1]|=8),this.updateStatusLine||(e[1]|=16),this.screen&&this.split&&(e[1]|=32),this.put(16,this.savedFlags),this.vocabulary||this.parseVocab(this.getu(8)),$=this.getu(10)-2,y=this.getu(12)-32,this.fwords=this.getu(24),i=[],r=[],t=this.getu(6),d=$+55},G=(c,p)=>{var fe,v;if(v=e[d+c*9+4])if(e[d+v*9+6]==c)e[d+v*9+6]=e[d+c*9+5];else{for(v=e[d+v*9+6];v!=c;)fe=v,v=e[d+v*9+5];e[d+fe*9+5]=e[d+c*9+5]}(e[d+c*9+4]=p)?(e[d+c*9+5]=e[d+p*9+6],e[d+p*9+6]=c):e[d+c*9+5]=0},j=(c,p)=>{if((c&=3)!=3)return h=p,[Z,k,M][c]()},M=c=>m(e[t++]),Z=()=>(t+=2,this.get(t-2)),k=()=>e[t++],b=c=>{var p=k();if(p&128&&(c=!c),p&64?p&=63:p=(p&63)<<8|k(),!c){if(p==0||p==1)return T(p);p&8192&&(p-=16384),t+=p-2}},O=()=>{var c=this.getu(d+n*9+7);for(c+=e[c]*2+1;e[c];){if((e[c]&31)==s)return a=c+1,!0;c+=(e[c]>>5)+2}return a=0,!1},T=c=>{r=i[0].ds,t=i[0].pc,i.shift(),g(c)},g=c=>{var p=k();p==0?r.push(c):p<16?i[0].local[p-1]=c:this.put(y+2*p,c)},_=c=>c==0?r[r.length-1]:c<16?i[0].local[c-1]:this.get(y+2*c),E=(c,p)=>{c==0?r[r.length-1]=p:c<16?i[0].local[c-1]=p:this.put(y+2*c,p)},W(),yield*this.restarted(),yield*this.highlight(!!(this.savedFlags&2));;)switch(u=k(),u<128?(u&64?n=M():n=k(),u&32?s=M():s=k(),u&=31,h=2):u<176?(l=u>>4&3,u&=143,l==0?n=Z():l==1?n=k():l==2&&(n=M())):u>=192&&(l=k(),n=j(l>>6,1),s=j(l>>4,2),o=j(l>>2,3),a=j(l>>0,4),u<224&&(u&=31)),u){case 1:b(n==s||h>2&&n==o||h==4&&n==a);break;case 2:b(n<s);break;case 3:b(n>s);break;case 4:E(n,l=_(n)-1),b(l<s);break;case 5:E(n,l=_(n)+1),b(l>s);break;case 6:b(e[d+n*9+4]==s);break;case 7:b((n&s)==s);break;case 8:g(n|s);break;case 9:g(n&s);break;case 10:S(),b(h&a);break;case 11:S(),this.put(o,h|a);break;case 12:S(),this.put(o,h&~a);break;case 13:E(n,s);break;case 14:G(n,s);break;case 15:g(this.get(n+s*2&65535));break;case 16:g(e[n+s&65535]);break;case 17:O()?g(e[a-1]&32?this.get(a):e[a]):g(this.get($+2*s));break;case 18:O(),g(a);break;case 19:s?(O(),g(e[a+(e[a-1]>>5)+1]&31)):(l=this.getu(d+n*9+7),g(e[l+e[l]*2+1]&31));break;case 20:g(n+s);break;case 21:g(n-s);break;case 22:g(Math.imul(n,s));break;case 23:g(Math.trunc(n/s));break;case 24:g(n%s);break;case 128:b(!n);break;case 129:g(l=e[d+n*9+5]),b(l);break;case 130:g(l=e[d+n*9+6]),b(l);break;case 131:g(e[d+n*9+4]);break;case 132:g((e[n-1&65535]>>5)+1);break;case 133:l=_(n),E(n,l+1);break;case 134:l=_(n),E(n,l-1);break;case 135:yield*this.genPrint(this.getText(n&65535));break;case 137:G(n,0);break;case 138:yield*this.genPrint(this.getText(this.getu(d+n*9+7)+1));break;case 139:T(n);break;case 140:t+=n-2;break;case 141:yield*this.genPrint(this.getText(P(n)));break;case 142:g(_(n));break;case 143:g(~n);break;case 176:T(1);break;case 177:T(0);break;case 178:yield*this.genPrint(this.getText(t)),t=this.endText;break;case 179:yield*this.genPrint(this.getText(t)+`
`),T(1);break;case 180:break;case 181:this.savedFlags=this.get(16),b(yield*this.save(this.serialize(r,i,t)));break;case 182:this.savedFlags=this.get(16),(f=yield*this.restore())&&(f=this.deserialize(f)),this.put(16,this.savedFlags),f&&(r=f[0],i=f[1],t=f[2]),b(f);break;case 183:W(),yield*this.restarted();break;case 184:T(r[r.length-1]);break;case 185:r.pop();break;case 186:return;case 187:yield*this.genPrint(`
`);break;case 188:this.updateStatusLine&&(yield*this.updateStatusLine(this.getText(this.getu(d+_(16)*9+7)+1),_(18),_(17)));break;case 189:b(this.verify());break;case 224:if(n){for(l=e[n=P(n)],i.unshift({ds:r,pc:t,local:new Int16Array(l)}),r=[],t=n+1,l=0;l<e[n];l++)i[0].local[l]=Z();h>1&&e[n]>0&&(i[0].local[0]=s),h>2&&e[n]>1&&(i[0].local[1]=o),h>3&&e[n]>2&&(i[0].local[2]=a)}else g(0);break;case 225:this.put(n+s*2&65535,o);break;case 226:e[n+s&65535]=o;break;case 227:O(),e[a-1]&32?this.put(a,o):e[a]=o;break;case 228:yield*this.genPrint(""),this.updateStatusLine&&(yield*this.updateStatusLine(this.getText(this.getu(d+_(16)*9+7)+1),_(18),_(17))),this.handleInput(yield*this.read(e[n&65535]),n&65535,s&65535);break;case 229:yield*this.genPrint(n==13?`
`:n?String.fromCharCode(n):"");break;case 230:yield*this.genPrint(String(n));break;case 231:g(n>0?Math.floor(Math.random()*n)+1:0);break;case 232:r.push(n);break;case 233:E(n,r.pop());break;case 234:this.split&&(yield*this.split(n));break;case 235:this.screen&&(yield*this.screen(n));break;default:throw new Error("JSZM: Invalid Z-machine opcode")}},save:()=>[],savedFlags:0,selfInsertingBreaks:null,serial:null,serialize:function(e,t,i){let r,n,s,o,a;for(s=this.getu(14),r=s+t.reduce((h,u)=>h+2*(u.ds.length+u.local.length)+6,0)+2*e.length+8,o=new Uint8Array(r),o.set(new Uint8Array(this.mem.buffer,0,s)),a=new DataView(o.buffer),a.setUint32(s,i),a.setUint16(s+4,t.length),a.setUint16(s+6,e.length),r=0;r<e.length;r++)a.setInt16(s+r*2+8,e[r]);for(s+=e.length*2+8,r=0;r<t.length;r++){for(a.setUint32(s,t[r].pc),a.setUint8(s,t[r].local.length),a.setUint16(s+4,t[r].ds.length),n=0;n<t[r].ds.length;n++)a.setInt16(s+n*2+6,t[r].ds[n]);for(n=0;n<t[r].local.length;n++)a.setInt16(s+t[r].ds.length*2+n*2+6,t[r].local[n]);s+=(t[r].ds.length+t[r].local.length)*2+6}return o},screen:null,split:null,statusType:null,updateStatusLine:null,verify:function(){let e=this.getu(26),t=this.getu(28),i=64;for(;i<e*2;)t=t-this.memInit[i++]&65535;return!t},view:null,vocabulary:null,zorkid:null};H.version=We;function Ge(e){let t,i,r,n,s,o;var a=e[0];function h(u,l){return{}}return a&&(n=ge(a,h()),n.$on("zinput",e[4])),{c(){t=ue("pre"),i=oe(e[2]),r=Ue(),n&&re(n.$$.fragment),s=Ae(),ye(t,"class","svelte-1n0b10g")},m(u,l){B(u,t,l),ze(t,i),e[6](t),B(u,r,l),n&&R(n,u,l),B(u,s,l),o=!0},p(u,[l]){if((!o||l&4)&&xe(i,u[2]),l&1&&a!==(a=u[0])){if(n){Ne();const f=n;ie(f.$$.fragment,1,0,()=>{q(f,1)}),Ze()}a?(n=ge(a,h()),n.$on("zinput",u[4]),re(n.$$.fragment),J(n.$$.fragment,1),R(n,s.parentNode,s)):n=null}},i(u){o||(n&&J(n.$$.fragment,u),o=!0)},o(u){n&&ie(n.$$.fragment,u),o=!1},d(u){u&&(C(t),C(r),C(s)),e[6](null),n&&q(n,u)}}}function Qe(e,t,i){let r,n;de(e,se,m=>i(11,n=m));let s,o,a=ke("");de(e,a,m=>i(2,r=m));let h="",u,{handler:l}=t,f="";Pe(async function(){const S=await(await fetch(Ke)).arrayBuffer();o=new H(S),o.print=y,o.read=d,i(5,s=o.run())});function*y(m){m?h+=m:(X(se,n=h,n),X(a,r+=h,r),h="",setTimeout(()=>{i(1,u.scrollTop=u.scrollHeight,u)},50))}function*d(m){f||(yield"");let S=f;return f="",S}function $(m){console.log("onZinput",m.detail),X(a,r+=` ${m.detail}
`,r),f=m.detail,s.next(),f=""}function P(m){D[m?"unshift":"push"](()=>{u=m,i(1,u)})}return e.$$set=m=>{"handler"in m&&i(0,l=m.handler)},e.$$.update=()=>{e.$$.dirty&32&&s&&s.next()},[l,u,r,a,$,s,P]}class Xe extends ce{constructor(t){super(),le(this,t,Qe,Ge,K,{handler:0})}}function Ye(e){let t,i,r;return i=new Xe({props:{handler:He}}),{c(){t=ue("main"),re(i.$$.fragment)},m(n,s){B(n,t,s),R(i,t,null),r=!0},p:w,i(n){r||(J(i.$$.fragment,n),r=!0)},o(n){ie(i.$$.fragment,n),r=!1},d(n){n&&C(t),q(i)}}}class et extends ce{constructor(t){super(),le(this,t,null,Ye,K,{})}}new et({target:document.getElementById("app")});
